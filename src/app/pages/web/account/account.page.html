<ion-header class="header-container" [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <div class="header-img">
      <img src="assets/icon/brandname.png" />
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="container fit-container ion-padding">
    <div class="title text-center ion-padding">Mi cuenta</div>

    <div class="content ion-padding" *ngIf="account">

      <!-- Source -->
      <div class="source">
        <ion-card>
          <div class="row flex-wrap justify-center ion-padding">
            <div class="col ion-padding" (click)="attachemntInput.click()">
              <img class="source-icon" *ngIf="account.source!.icon !== undefined && account.source!.icon !== ''"
                [src]="account.source!.icon" alt="" />
              <div *ngIf="account.source!.icon === undefined || account.source!.icon === ''" class="initial-circle">
                {{ account.source!.name.charAt(0) | uppercase }}
              </div>
            </div>
            <input hidden #attachemntInput type="file"  accept="image/*" (change)="editPicture($event)"/>
            <div class="main-col text-center">
              <div class="row ion-padding-bottom justify-center">
                <div class="card-title">
                  {{account.source!.name}}
                </div>
                <div>
                  <ion-button class="ion-padding-left" fill="clear" (click)="editName()">
                    <ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
                  </ion-button>
                </div>
              </div>
              <div class="account-description text-start">
                <div class="row">
                  Identificador: <span class="ion-padding-start short-id"> #{{account.source!.shortId}}</span>
                </div>
                <div class="row ion-padding-bottom disclaimer">
                  Usado para ser encontrado en la app (Cuentas privadas).
                </div>
                <div class="row ion-padding-bottom">
                  Correo: <span class="ion-padding-start short-id"> {{account.source!.email}}</span>
                </div>
                <div class="row ion-padding-bottom">
                  <ion-toggle [checked]="account.source!.public" (ionChange)="updatePublicFlag($event)"
                    helperText="Las cuentas públicas podrán ser buscadas en la app." justify="space-between">
                    Cuenta pública
                  </ion-toggle>
                </div>
              </div>
            </div>
          </div>
        </ion-card>

        <!-- Statistics-->
        <div class="statistics row flex-wrap">

          <!-- Subscriptors-->
          <div class="col statistic">
            <ion-card>
              <div class="text-center ion-padding">
                <div class="card-title ion-padding-bottom">
                  Suscriptores
                </div>
                <div class="row statistics-data ion-padding-bottom">
                  <div style="padding-right: 4px;">{{account.source.subscriptors | number:'1.0-0':'es-ES'}}</div> de 
                  <div style="padding-left: 4px;">
                    <ng-container *ngIf="planDetail!.subscriptions != 'Ilimitado'">{{planDetail!.subscriptions! | number:'1.0-0':'es-ES'}}</ng-container>
                    <ng-container *ngIf="planDetail!.subscriptions == 'Ilimitado'">Ilimitado</ng-container>
                  </div>
                </div>
                <div class="ion-padding-bottom">
                  <ion-progress-bar [value]="subscriptorsProgress"></ion-progress-bar>
                </div>
                <div class="disclaimer ion-padding-top">Número de subscriptores totales.</div>
  
              </div>
            </ion-card>
          </div>
          <!-- Notifications -->
          <div class="col statistic">
            <ion-card>
              <div class="text-center ion-padding">
                <div class="card-title ion-padding-bottom">
                  Notificaciones
                </div>
                <div class="row statistics-data ion-padding-bottom">
                  <div style="padding-right: 4px;">{{account.events | number:'1.0-0':'es-ES'}}</div> de 
                  <div style="padding-left: 4px;">
                    <ng-container *ngIf="planDetail!.notifications != 'Ilimitado'">{{planDetail!.notifications! | number:'1.0-0':'es-ES'}}</ng-container>
                    <ng-container *ngIf="planDetail!.notifications == 'Ilimitado'">Ilimitado</ng-container>
                  </div>
                </div>
                <div class="ion-padding-bottom">
                  <ion-progress-bar [value]="notificationsProgress"></ion-progress-bar>
                </div>
                <div class="disclaimer ion-padding-top">Número de notificaciones enviadas en el mes actual.</div>
              </div>
            </ion-card>
          </div>
        </div>

        <!-- Plan and Payments -->
        <div class="row flex-wrap">

          <!-- Plan-->
          <div class="col plan-detail" *ngIf="planDetail">
            <ion-card>
              <div class="text-center ion-padding">
                <div class="card-title">Plan actual</div>
                <div class="plan-title ion-padding-top">{{planDetail.name}}</div>
                <div class="plan-content">
                  <ul>
                      <li><ion-icon name="checkmark-circle-outline"></ion-icon>{{planDetail.ads ? 'Con anuncios' : 'Sin anuncios' }}</li>
                      <li><ion-icon name="checkmark-circle-outline"></ion-icon>{{planDetail.subscriptions == 'Ilimitado' ? 'Ilimitado' : 'Hasta ' + (planDetail.subscriptions | number:'1.0-0':'es-ES') + ' suscriptores'}}</li>
                      <li><ion-icon name="checkmark-circle-outline"></ion-icon> {{planDetail.notifications == 'Ilimitado' ? 'Ilimitado' : 'Hasta ' + (planDetail.notifications | number:'1.0-0':'es-ES') + ' al mes'}}</li>
                  </ul>
                </div>

                <div class="ion-padding">
                  <ion-button color="secondary" shape="round" (click)="updatePlan()">Actualizar plan</ion-button>
                </div>
              </div>
            </ion-card>
          </div>
          <!-- Payments -->
          <div class="col payments">
            <ion-card>
              <div class="text-center ion-padding">
                <div class="card-title ion-padding-bottom">
                  Últimas facturas
                </div>

                <div class="latest-transactions ion-padding-start ion-padding-end" *ngIf="transactions">
                  <div class="transaction row" *ngFor="let t of transactions">
                    <div class="transaction-date ion-padding-end col">{{ t.date * 1000 | date:'dd/MM/yyyy' }}</div>
                    <div class="transaction-amount col">{{ t.amount / 100 | currency:'EUR':'symbol':'1.2-2':'es-ES'  }}</div>
                    <div class="transaction-invoice ion-padding-start col">
                      <ion-button (click)="downloadInvoice(t.invoice)"><ion-icon slot="icon-only" name="download"></ion-icon></ion-button>
                    </div>
                  </div>
                </div>

                <div class="ion-padding">
                  <ion-button color="secondary" shape="round" (click)="openPortalSession()">Ver más</ion-button>
                </div>
                
              </div>
            </ion-card>
          </div>
        </div>

      </div>
    </div>
  </div>
</ion-content>